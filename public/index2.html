<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Client</title>
    <link rel="icon" href="images/icon.png">
</head>
<body>
    <h1>Phone Controller</h1>
    <input id="serverID" placeholder="Enter server ID" type="text">
    <button id="moveLeftBtn">Move Left</button>

    <script type="module">
        const ws = new WebSocket("ws://localhost:8080");    // https://mystery-history-9d9aa246ca8c.herokuapp.com
                                                            // ws://localhost:8080
        
        const serverIDInput = document.getElementById('serverID');

        ws.onopen = function() {
            console.log("Connected to WebSocket server");
            ws.send("Hello from HTML");
        };

        ws.onmessage = function(event) {
            if (event.data instanceof Blob) {
                // Convert Blob to text (UTF-8 encoding)
                var reader = new FileReader();
                reader.onload = function() {
                    var message = reader.result;
                    console.log("Received message:", message);  // Log the decoded message
                };
                reader.readAsText(event.data);  // Convert Blob to a string
            } else {
                console.log("Received message:", event.data);  // This handles text messages directly
            }
        };

        ws.onerror = function(error) {
            console.error("WebSocket Error: " + error);
        };

        ws.onclose = function() {
            console.log("WebSocket connection closed");
        };

        // Define the sendInput function
        function sendInput(command) {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send(command);
                console.log("Sent: " + command);
            }
        }

        // Attach event listeners to buttons to call sendInput with specific commands
        document.getElementById('moveLeftBtn').addEventListener('click', function() {
            sendInput('joinRoom ' + serverIDInput.value);
        });
        
        ws.addEventListener('message', function (event) {
            console.log('Message from server: ', event.data);
            
            const data = JSON.parse(event.data);

            // Check if the server sent a redirect instruction
            if (data.action === 'redirect' && data.url) {
                // Redirect to the new URL
                const player = '2';
                window.location.href = data.url + `?player=${encodeURIComponent(player)}`;
            }
        });

    </script>
</body>
</html>
